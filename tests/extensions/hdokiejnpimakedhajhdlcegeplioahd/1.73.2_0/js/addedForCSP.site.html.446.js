var data=null;var existing=null;var origusername=null;var origpassword=null;function onLoad(I){clearData();if(!I){get_data("site",function(){onLoad(true)});return}var D=getBG();data=D.g_site_data;D.g_site_data=null;if(D.g_generatedpw){document.getElementById("pwprotect").style.visibility="hidden";document.getElementById("pwprotectlabel").style.visibility="hidden"}existing=data&&typeof(data.aid)!="undefined"&&data.aid&&data.aid!=""&&data.aid!="0";if(data){document.getElementById("url").value=data.url;
if(data.editfields){document.getElementById("urlrow").style.display="none";document.getElementById("namegrouprow").style.display="none";document.getElementById("usernamepasswordrow").style.display="none";document.getElementById("notesrow1").style.display="none";document.getElementById("notesrow2").style.display="none";document.getElementById("checkboxrow1").style.display="none";document.getElementById("checkboxrow2").style.display="none";document.getElementById("fieldsrow2").style.display="";document.getElementById("fields").contentWindow.document.body.innerHTML=getFieldsHTML()
}else{if(data.save_all){document.getElementById("usernamepasswordrow").style.display="none";document.getElementById("fieldsrow1").style.display="";document.getElementById("fieldsrow2").style.display="";if(existing){document.getElementById("fields").contentWindow.document.body.innerHTML=getFieldsHTML()}else{document.getElementById("fields").contentWindow.document.body.innerHTML=getDataHTML()}}else{if(data.sn){document.getElementById("usernamepasswordrow").style.display="none";document.getElementById("urlrow").style.display="none"
}else{if(existing){document.getElementById("username").value=data.unencryptedUsername;document.getElementById("password").value=D.lpmdec(data.password,true);document.getElementById("editfields").style.display="";origusername=data.username;origpassword=data.password}else{document.getElementById("username").value=data.username;document.getElementById("password").value=data.password}}}}if(!existing&&typeof(data.addsite)!="undefined"){document.getElementById("name").value=D.getname_url(data.url)}if(existing){document.getElementById("name").value=data.name;
document.getElementById("group").value=data.group;document.getElementById("notes").value=D.lpmdec(data.extra,true);document.getElementById("fav").checked=data.fav=="1";document.getElementById("pwprotect").checked=data.pwprotect;document.getElementById("autologin").checked=data.autologin;document.getElementById("never_autofill").checked=data.never_autofill}else{if(data.sn){document.getElementById("group").value=gs("Secure Notes")}}if(data.sn==1){document.getElementById("checkboxrow1").style.display="none";
document.getElementById("autologingrp").style.visibility="hidden"}}if(existing&&!data.editfields){document.getElementById("del").style.display="";document.getElementById("share").style.display=""}else{document.getElementById("del").style.display="none";document.getElementById("share").style.display="none"}var C=new Array();for(aid in D.g_sites){if(D.check_ident_aid(aid)){var F=D.g_sites[aid].group;if(F!=""&&!lp_in_array(F,C)){C[C.length]=F}}}for(aid in D.g_securenotes){if(D.check_ident_aid(aid)){var F=D.g_securenotes[aid].group;
if(F!=""&&!lp_in_array(F,C)){C[C.length]=F}}}C.sort(function(K,J){return K.toLowerCase()<J.toLowerCase()?-1:1});create_combo("group",C);if(!existing&&data&&!data.save_all&&!data.noreplace){var H=D.getsites(lp_gettld_url(data.url),true);var G=new Array();for(var E in H){G[G.length]=E}G.sort(function(K,J){return D.g_sites[K].name.toLowerCase()<D.g_sites[J].name.toLowerCase()?-1:1});var A=document.getElementById("replaceexistingsiteaid");for(var E=0;E<G.length;E++){var B=D.g_sites[G[E]].name;if(typeof(D.g_sites[G[E]].useusername)&&D.g_sites[G[E]].useusername!=""){B+=" ("+D.g_sites[G[E]].useusername+")"
}A.options[A.options.length]=new Option(B,G[E])}if(A.options.length>1){for(var E=1;E<=4;E++){document.getElementById("addreplacerow"+E).style.display=""}}}if(D.g_ischrome&&D.g_premium_exp>lp_get_local_timestamp()&&D.g_isadmin){if(typeof(data)!="undefined"&&data.sn==1){document.getElementById("attach").style.display="";if(typeof(data.attachid)=="undefined"||data.attachid==null||data.attachid==0){document.getElementById("lpaddattach").style.display=""}else{document.getElementById("lprmattach").display="";
document.getElementById("lpshowattach").innerHTML=data.attachname}}}update_password_meter("",document.getElementById("password").value);buildSecureNotes();onResize()}function buildSecureNotes(){if(typeof(data)!="undefined"&&data.sn==1){document.getElementById("notesrow0").style.display="";document.getElementById("notesrow1").style.display="none";var D=document.getElementById("notestype");var B=D.val;var E=[];for(var C in sntemplates){var A=typeof(sntemplateicons[C])!="undefined"?sntemplateicons[C]:geticonurl("sn");
E[E.length]={label:gs(C),image:A,value:C}}create_combo("notestype",E);if(existing){B=getNoteValue("NoteType",document.getElementById("notes").value)}if(!B||typeof(sntemplates[B])=="undefined"){B="Generic"}buildForm(B);onResize()}}function buildForm(T){var D=document.getElementById("notestype");D.value=gs(T);D.val=T;D.style.paddingLeft="25px";var S=typeof(sntemplateicons[T])!="undefined"?sntemplateicons[T]:geticonurl("sn");D.style.background="url("+S+") no-repeat 2px 5px";document.getElementById("notesrow2").style.display=(T=="Generic"?"":"none");
document.getElementById("notesrow3").style.display=(T=="Generic"?"none":"");document.getElementById("notestype").disabled=(existing?true:false);if(T=="Generic"){return}var K=document.getElementById("dynamicnotes");while(K.hasChildNodes()&&K.childNodes.length>0){K.removeChild(K.firstChild)}var R=sntemplates[T];var O=document.createElement("table");O.style.width="100%";O.style.borderSpacing="0px";for(var N in R){var C=document.createElement("tr");var B=document.createElement("td");B.style.whiteSpace="nowrap";
var A=document.createElement("td");A.style.width="100%";var E=document.createTextNode(gsproper(N)+":");B.appendChild(E);var J=null;if(R[N]=="text"){J=document.createElement("input");J.type="text";J.id="note_"+N;J.style.width="100%";if(existing){J.value=getNoteValue(N,document.getElementById("notes").value)}}else{if(R[N]=="date"||R[N]=="datemoyr"){J=document.createElement("span");J.style.width="100%";var P=document.createElement("select");P.id="note_"+N+"_mo";P.style.width="auto";var I=["January","February","March","April","May","June","July","August","September","October","November","December"];
for(var L in I){P.options[P.options.length]=new Option(gs(I[L]),gs(I[L]))}var G=null;if(existing){G=getNoteValue(N,document.getElementById("notes").value);if(G){G=G.split(",")}if(G&&G.length>0){P.value=G[0]}}J.appendChild(P);if(R[N]=="date"){var M=document.createElement("select");M.id="note_"+N+"_day";for(var L=1;L<=31;L++){M.options[M.options.length]=new Option(L,L)}if(G&&G.length>1){M.value=G[1]}J.appendChild(M)}var F=document.createElement("input");F.type="text";F.maxLength=4;F.size=4;F.id="note_"+N+"_yr";
var Q=R[N]=="date"?2:1;if(G&&G.length>Q){F.value=G[Q]}J.appendChild(F)}else{if(R[N]=="textarea"){B.style.verticalAlign="top";J=document.createElement("textarea");J.cols=30;J.rows=7;J.id="note_"+N;J.style.width="100%";if(existing){J.value=getNoteValue(N,document.getElementById("notes").value,true)}}else{continue}}}A.appendChild(J);C.appendChild(B);C.appendChild(A);O.appendChild(C)}var H=document.createElement("fieldset");H.appendChild(O);K.appendChild(H)}function onResize(){if(typeof(data)!="undefined"&&data!=null&&data.sn==1){var B=document.getElementById("thetable");
var A=document.getElementById("notes");A.style.height=window.innerHeight-B.offsetTop-(B.clientHeight-A.clientHeight)-20}}function fix_addreplace(){if(document.getElementById("addnewsite").checked){document.getElementById("url").disabled=false;document.getElementById("name").disabled=false;document.getElementById("group").disabled=false;document.getElementById("username").disabled=false;document.getElementById("password").disabled=false;document.getElementById("notes").disabled=false;document.getElementById("fav").disabled=false;
document.getElementById("never_autofill").disabled=false;document.getElementById("pwprotect").disabled=false;document.getElementById("autologin").disabled=false;document.getElementById("replaceexistingsiteaid").disabled=true}else{if(document.getElementById("replaceexistingsite").checked){document.getElementById("url").disabled=true;document.getElementById("name").disabled=true;document.getElementById("group").disabled=true;document.getElementById("username").disabled=true;document.getElementById("password").disabled=true;
document.getElementById("notes").disabled=true;document.getElementById("fav").disabled=true;document.getElementById("never_autofill").disabled=true;document.getElementById("pwprotect").disabled=true;document.getElementById("autologin").disabled=true;document.getElementById("replaceexistingsiteaid").disabled=false}}}function getSecureNoteFromFields(){if(typeof(data)!="undefined"&&data.sn==1){var A=document.getElementById("notestype").val;if(A=="Generic"||document.getElementById("notesrow0").style.display=="none"){return document.getElementById("notes").value
}var C="NoteType:"+A+"\n";for(var B in sntemplates[A]){if(sntemplates[A][B]=="text"){C+=B+":"+document.getElementById("note_"+B).value+"\n"}else{if(sntemplates[A][B]=="date"||sntemplates[A][B]=="datemoyr"){C+=B+":"+document.getElementById("note_"+B+"_mo").value;if(sntemplates[A][B]=="date"){C+=","+document.getElementById("note_"+B+"_day").value}C+=","+document.getElementById("note_"+B+"_yr").value+"\n"}else{if(sntemplates[A][B]=="textarea"){C+=B+":"+document.getElementById("note_"+B).value+"\n"}}}}return C
}return document.getElementById("notes").value}function dosave(){var N=document.getElementById("replaceexistingsite").checked;if(N&&document.getElementById("replaceexistingsiteaid").selectedIndex==0){alert(gs("Please Make a Selection"));return}if(data.editfields){checkFieldsForUpdates();getBG().close_editfieldsopener();setTimeout(function(){getBG().closecurrenttab("site.html")},0);return}var E=document.getElementById("url").value;var X=document.getElementById("name").value;var I=document.getElementById("group").value;
var D=document.getElementById("username").value;var A=document.getElementById("password").value;var M=getSecureNoteFromFields();var W=document.getElementById("fav").checked;var L=document.getElementById("never_autofill").checked;var U=document.getElementById("pwprotect").checked;var F=document.getElementById("autologin").checked;var C=getBG();if(!C.lploggedin){console_log("Not logged in!");return}if(N){var G=C.g_sites[document.getElementById("replaceexistingsiteaid").value];X=G.name;I=G.group;M=C.lpmdec(G.extra,true);
W=G.fav=="1";L=G.never_autofill;U=G.pwprotect;F=G.autologin}if(X==""){alert(gs("You must enter a name."));return}if(M.length>45000){M=M.substring(0,45000)}var J=existing?(data.sn?C.g_securenotes[data.aid]:C.g_sites[data.aid]):C.createNewAcct();J.name=X;J.group=I;J.url=E;if(E=="http://sn"){J.sn=1}var H=lp_gettld_url(J.url);if(existing&&!J.sn){C.fix_tlds(J.tld,H,data.aid)}J.tld=H;J.unencryptedUsername=D;if(D!=C.lpmdec(J.username,true)){J.username=C.lpmenc(D,true)}if(A!=C.lpmdec(J.password,true)){J.password=C.lpmenc(A,true)
}J.extra=C.lpmenc(M,true);J.fav=W?"1":"0";J.autologin=F;J.never_autofill=L;J.pwprotect=U;if(!existing){J.aid="0"}if(existing){var B=E!=data.url||X!=data.name||I!=data.group||D!=data.unencryptedUsername||A!=C.lpmdec(data.password,true)||M!=C.lpmdec(data.extra,true)||W!=(data.fav=="1")||L!=data.never_autofill||U!=data.pwprotect||F!=data.autologin;if(B){if(J.sn){C.g_securenotes[J.aid]=J}else{C.g_sites[J.aid]=J}var S=false,Q=false;for(var P=0;J.fields&&P<getcount(J.fields);P++){var T=J.fields[P];if(T.value==origpassword){Q=true;
if(T.type=="password"){T.value=J.password}}if(T.value==origusername){S=true;if("text"==T.type||"email"==T.type){T.value=J.username}}}if((!S&&J.username!="")||(!Q&&J.password!="")){if(J.fields){for(var P=getcount(J.fields)-1;P>=0;P--){if(!J.fields[P].otherfield){J.fields.splice(P,1)}}}}if(g_issafari||g_isopera){C.update_site(data.aid)}C.increment_local_accts_version();C.rewritelocalfile();var V="ajax=1&extjs=1&name="+C.en(C.lpenc(X))+"&url="+C.en(C.bin2hex(E))+"&grouping="+C.en(C.lpenc(I))+"&username="+C.en(crypto_btoa(J.username))+"&password="+C.en(crypto_btoa(J.password))+"&extra="+C.en(C.lpenc(M))+"&openid_url=&aid="+C.en(data.aid)+"&basic_auth=0&isbookmark=0&localupdate=1";
V+=(U?"&pwprotect=on":"");V+=(L?"&never_autofill=on":"");V+=(F?"&autologin=on":"");V+=(W?"&fav=on":"");J.newvalues=[];C.saveSite(V,J)}if(data.save_all){checkFieldsForUpdates()}}else{J.fields=new Array();var O=[];var K=updateAndEncryptData(C,J.username,J.password,J.fields,J,O);var V="name="+C.en(C.lpenc(X))+"&grouping="+C.en(C.lpenc(I))+"&data="+C.en(C.bin2hex(K))+"&extra="+C.en(C.lpenc(M))+(U?"&pwprotect=on":"")+(L?"&never_autofill=on":"")+(F?"&autologin=on":"")+(W?"&fav=on":"");V+="&extjs=1&localupdate=1";
if(E=="http://sn"){var R=getNoteValue("NoteType",M);V+=(R&&R!=""?"&notetype="+C.en(R):"")}if(N){V+="&replacing=1"}if(data.save_all){J.save_all=true;V+="&ajax=1&aid=0&save_all=1&url="+C.en(C.bin2hex(E))+"&openid_url=&username=&password=";J.newvalues=O;C.saveAllSite(V,J)}else{if(typeof(data.formdata)!="undefined"){V+="&ref="+C.en(C.bin2hex(E));if(N){V+="&aid="+C.en(document.getElementById("replaceexistingsiteaid").value)}J.newvalues=O;C.saveSiteFromSubmit(V,J)}else{V+="&ajax=1&aid=0&url="+C.en(C.bin2hex(E))+"&openid_url=&username="+C.en(crypto_btoa(J.username))+"&password="+C.en(crypto_btoa(J.password));
J.newvalues=O;C.saveSite(V,J)}}}setTimeout(function(){getBG().closecurrenttab("site.html")},0)}function checkFieldsForUpdates(){var H=getBG();var N=document.getElementById("fields").contentWindow.document;var D=false;for(var I in data.fields){var L=data.fields[I];if(L.type=="text"||L.type=="email"||L.type=="password"||L.type=="textarea"){var B=N.getElementById(L.formname+"_"+L.name);if(B&&typeof(B.value)!="undefined"&&H.lpmdec(L.value,true)!=B.value){D=true;var M=H.lpmenc(B.value,true);if(L.value!=""&&H.g_sites[data.aid].username!=""&&L.value==H.g_sites[data.aid].username&&B.value!=""){H.g_sites[data.aid].username=M;
H.g_sites[data.aid].unencryptedUsername=B.value}if(L.value!=""&&H.g_sites[data.aid].password!=""&&L.value==H.g_sites[data.aid].password&&B.value!=""){H.g_sites[data.aid].password=M}L.value=M}}else{if(L.type=="checkbox"||L.type=="radio"){var E=L.checked;var A=N.getElementById(L.formname+"_"+L.name)&&N.getElementById(L.formname+"_"+L.name).checked;if(E!=A){D=true;L.checked=A}}else{if(L.type=="select-one"){if(L.faketype){var B=N.getElementById(L.formname+"_"+L.name);if(B&&typeof(B.value)!="undefined"&&L.value!=B.value){D=true;
L.value=B.value}}}}}}if(D){if(g_issafari||g_isopera){H.update_site(data.aid);H.update_fields(data.aid,data.fields)}H.increment_local_accts_version();H.rewritelocalfile();var C="update=1&aid="+H.en(data.aid)+"&urid=0";var K="";var O=[];for(var I in data.fields){var L=data.fields[I];var J;if(data.editfields&&L.formname==""){J="_"+L.name}else{J="_"+L.formname+"_"+L.name}if(L.type=="text"||L.type=="email"||L.type=="password"||L.type=="textarea"){var F=N.getElementById(L.formname+"_"+L.name).value;O.push(F);
F=crypto_btoa(L.value);K+=J+"="+H.en(F)+"&"}else{if(L.type=="checkbox"){if(N.getElementById(L.formname+"_"+L.name).checked){K+=J+"="+H.en(L.value)+"&"}}else{if(L.type=="select-one"){if(L.faketype){var F=N.getElementById(L.formname+"_"+L.name).value;K+=J+"="+H.en(F)+"&"}}}}}K+="&auto=1";var G={url:base_url+"fields.php?"+C,aid:data.aid,postdata:K,param:null,newvalues:O};H.saveFields(C,K,G)}}function updateAndEncryptData(F,H,C,N,I,P){var E="";var B=typeof(data.formdata)!="undefined"?data.formdata.split("\n"):new Array();
var R=false;var A=0;var M=0;for(var Q=0;Q<B.length;Q++){var J=B[Q];var L=J.split("\t");if(L.length!=4){continue}if("text"==L[3]||"email"==L[3]){A++}else{if(L[3]=="password"){M++}}}if(A==0&&M==2&&!data.save_all){R=true}for(var Q=0;Q<B.length;Q++){var J=B[Q];var L=J.split("\t");if(L.length!=4){continue}var K=data.save_all?decodeURIComponent(L[0]):"0";var T=decodeURIComponent(L[1]);var S=decodeURIComponent(L[2]);var O=getBG().lpmenc(S,true);var G=L[3];if(G=="text"||G=="password"||G=="hidden"||G=="textarea"||"email"==G){if("email"==G&&S==data.username){O=H
}if(G=="text"&&S==data.username){O=H}if(G=="password"&&R){O=H;R=false}else{if(G=="password"&&S==data.password){O=C}}S=lpmdec(O,true);if(P){P.push(S)}E+=K+"\t"+F.en(T)+"\t"+F.en(crypto_btoa(O))+"\t"+F.en(G)+"\n";if(G!="hidden"){var D=new Array();D.otherfield=data.save_all;D.name=T;D.type=G;D.value=O;D.checked=false;D.formname=data.save_all?K:"";D.urid="0";D.otherlogin="0";D.url="";N[N.length]=D}}else{if(G=="action"){E+=K+"\taction\t"+F.en(S)+"\taction\n";I.action=F.bin2hex(S)}else{if(G=="method"){E+=K+"\tmethod\t"+F.en(S)+"\tmethod\n";
I.method=S}else{E+=K+"\t"+F.en(T)+"\t"+F.en(S)+"\t"+F.en(G)+"\n";if(G=="checkbox"||G=="radio"||G=="select-one"){var D=new Array();D.otherfield=data.save_all;D.name=T;D.type=G;if(G=="checkbox"||G=="radio"){D.checked=S.substring(S.length-2)=="-1";D.value=S.substring(0,S.length-2)}else{D.value=S}D.formname=data.save_all?K:"";D.urid="0";D.otherlogin="0";D.url="";N[N.length]=D}}}}}return E}function getDataHTML(){var F='<link rel="stylesheet" type="text/css" href="general.css">';var I=data.formdata.split("\n");
for(var C=0;C<I.length;C++){var J=I[C];var D=J.split("\t");if(D.length!=4){continue}var E=data.save_all?decodeURIComponent(D[0]):"0";var A=decodeURIComponent(D[1]);var B=decodeURIComponent(D[2]);var G=D[3];var H=E+"_"+A;if("text"==G||"password"==G||"email"==G){F+=lpxmlescape(A)+' <input readonly id="'+lpxmlescape(H)+'" name="'+lpxmlescape(A)+'" type="'+lpxmlescape(G)+'" value="'+lpxmlescape(B)+'">';if(G=="password"){F+=' <a id="'+lpxmlescape(H)+'toggle" href="#" onclick="parent.toggle_password(document.getElementById(\''+lpxmlescape(H)+"'), document.getElementById('"+lpxmlescape(H)+"toggle')); return false;\">"+gs("[Show]")+"</a>"
}F+="<br>"}else{if(G=="textarea"){F+=lpxmlescape(A)+' <textarea readonly name="'+lpxmlescape(A)+'">'+lpxmlescape(B)+"</textarea><br>"}else{if(G=="select-one"){F+=lpxmlescape(A)+' <select name="'+lpxmlescape(A)+'"><option value="'+lpxmlescape(B)+'">'+lpxmlescape(B)+"</option></select><br>"}else{if(G=="checkbox"||G=="radio"){checked=B.substring(B.length-2)=="-1"?" checked":"";if(G=="radio"&&checked==""){continue}B=B.substring(0,B.length-2);F+='<input disabled type="'+lpxmlescape(G)+'" value="'+lpxmlescape(B)+'"'+checked+"> "+lpxmlescape(A)+"<br>"
}}}}}return F}function showaddfield(){var A=document.getElementById("fields").contentWindow.document;A.getElementById("addfield").style.display=""}function doaddfield(){var E=getBG();var K=document.getElementById("fields").contentWindow.document;var B=K.getElementById("newname").value;var I=K.getElementById("newtype").value;var D=I;if(D=="select-one"){D="text"}var G=K.getElementById("newformname")?K.getElementById("newformname").value:"";if(B==""){alert(gs("You must enter a name."));return}for(var F in data.fields){if(data.fields[F].name==B&&(data.editfields||data.fields[F].formname==G)){alert(gs("You must enter a unique name."));
return}}var L=G+"_"+B;var H='<div id="'+L+'_div">';if(I=="text"||I=="password"||I=="select-one"||"email"==I){H+=lpxmlescape(B)+' <input id="'+lpxmlescape(L)+'" type="'+lpxmlescape(D)+'">';if(I=="password"){H+=' <a id="'+lpxmlescape(L)+'toggle" href="#" onclick="parent.toggle_password(document.getElementById(\''+lpxmlescape(L)+"'), document.getElementById('"+lpxmlescape(L)+"toggle')); return false;\">"+gs("[Show]")+"</a>"}}else{if(I=="textarea"){H+=lpxmlescape(B)+' <textarea id="'+lpxmlescape(L)+'"></textarea>'
}else{if(I=="checkbox"){H+='<input type="'+lpxmlescape(I)+'" id="'+lpxmlescape(L)+'"> <label for="'+lpxmlescape(L)+'">'+lpxmlescape(B)+"</label>"}}}H+=' <a href="#" onclick="parent.delete_field(\''+lpxmlescape(L)+"_div', '"+lpxmlescape(B)+"', ''); return false;\">[ - ]</a></div>";K.body.innerHTML+=H;var J=new Object();J.otherfield=!data.editfields;J.name=B;J.type=I;if(I=="select-one"){J.faketype=D}J.value="";J.formname=G;J.checked=false;J.urid="0";J.otherlogin="0";J.url="";data.fields[data.fields.length]=J;
if(g_issafari||g_isopera){E.update_fields(data.aid,data.fields)}E.increment_local_accts_version();E.rewritelocalfile();var A="add=1&aid="+E.en(data.aid)+"&urid=0&name="+E.en(B)+"&type="+I;if(!data.editfields){A+="&formname="+E.en(G)}A+="&auto=1";var C={url:base_url+"fields.php?"+A,aid:data.aid,postdata:"",param:null,newvalues:[]};E.saveFields(A,"",C);K.getElementById("newname").value="";K.getElementById("newtype").selectedIndex=0;if(K.getElementById("newformname")){K.getElementById("newformname").value=""
}K.getElementById("addfield").style.display="none"}function getFieldsHTML(){var C=getBG();var G='<link rel="stylesheet" type="text/css" href="general.css">';G+='<a href="#" onclick="parent.showaddfield(); return false;">'+gs("Add Field")+'</a><br><div id="addfield" style="display: none;">'+gs("Name:")+' <input type="text" id="newname" value=""><br>'+gs("Type:")+' <select id="newtype"><option value="text">'+gs("Text")+'</option><option value="password">'+gs("Password")+'</option><option value="select-one">'+gs("Select")+'</option><option value="checkbox">'+gs("Checkbox")+"</option></select><br>";
if(!data.editfields){G+=gs("Form Name:")+' <input type="text" id="newformname" value=""><br>'}G+='<input type="button" value="'+gs("Add")+'" onclick="parent.doaddfield();"><br><br></div>';for(var D in data.fields){var I=data.fields[D];var F=I.formname;var A=I.name;var B=I.value?I.value:"";var E=B;var H=I.type;var L=F+"_"+A;var K="";if("text"==H||"password"==H||"email"==H){E=crypto_btoa(B);B=C.lpmdec(B,true);K+=lpxmlescape(A)+' <input id="'+lpxmlescape(L)+'" type="'+lpxmlescape(H)+'" value="'+lpxmlescape(B)+'">';
if(H=="password"){K+=' <a id="'+lpxmlescape(L)+'toggle" href="#" onclick="parent.toggle_password(document.getElementById(\''+lpxmlescape(L)+"'), document.getElementById('"+lpxmlescape(L)+"toggle')); return false;\">"+gs("[Show]")+"</a>"}}else{if(H=="textarea"){E=crypto_btoa(B);B=C.lpmdec(B,true);K+=lpxmlescape(A)+' <textarea id="'+lpxmlescape(L)+'">'+lpxmlescape(B)+"</textarea>"}else{if(H=="select-one"){K+=lpxmlescape(A)+' <select id="'+lpxmlescape(L)+'"><option value="'+lpxmlescape(B)+'">'+lpxmlescape(B)+"</option></select>"
}else{if(H=="checkbox"||H=="radio"){var J=I.checked?" checked":"";if(H=="radio"&&J==""){continue}K+='<input type="'+lpxmlescape(H)+'" id="'+lpxmlescape(L)+'" '+J+'> <label for="'+lpxmlescape(L)+'">'+lpxmlescape(A)+"</label>"}else{continue}}}}K+=' <a href="#" onclick="parent.delete_field(\''+lpxmlescape(L)+"_div', '"+lpxmlescape(A)+"', '"+lpxmlescape(E)+"'); return false;\">[ - ]</a>";G+='<div id="'+L+'_div">'+K+"</div>"}return G}function delete_field(C,A,I){if(confirm(gs("Are you sure you would like to delete this field?"))){var F=getBG();
var H=document.getElementById("fields").contentWindow.document;H.getElementById(C).style.display="none";for(var G=getcount(data.fields)-1;G>=0;G--){if(data.fields[G].name==A){var D=data.fields[G].value;if(data.fields[G].type=="text"||data.fields[G].type=="password"||data.fields[G].type=="textarea"||"email"==data.fields[G].type){D=crypto_btoa(D)}if(D==I){data.fields.splice(G,1)}}}if(g_issafari||g_isopera){F.update_fields(data.aid,data.fields)}F.increment_local_accts_version();F.rewritelocalfile();
var B="delete=1&aid="+F.en(data.aid)+"&urid=0&name="+F.en(A)+"&value="+F.en(I);B+="&auto=1";var E={url:base_url+"fields.php?"+B,aid:data.aid,postdata:"",param:null,newfields:[]};F.saveFields(B,"",E)}}function dodel(){var A=getBG();A.deleteAid(data.aid,window,false,false,function(){setTimeout(function(){getBG().closecurrenttab("site.html")},0)})}function doshare(){var A=getBG();A.openbaseurl("?ac=1&share="+A.en(data.aid));setTimeout(function(){window.close()},0)}function docancel(){setTimeout(function(){getBG().closecurrenttab("site.html")
},0)}function toggle_password(B,A,D){if(B.type=="password"){if(existing){var C=getBG();if(data.sharedfromaid!=null&&data.sharedfromaid!=""&&data.sharedfromaid!="0"&&data.sharedfromaid!="null"){alert(gs("This is a shared site. You are not permitted to view the password."));return}else{if(C.g_prompts.view_pw_prompt){C.security_prompt(function(){B.type="text";A.innerHTML=gs("[Hide]")});return}}}B.type="text";A.innerHTML=gs("[Hide]")}else{B.type="password";A.innerHTML=gs("[Show]")}}function gsproper(A){if(gs(A+"proper")!=A+"proper"){return gs(A+"proper")
}return gs(A)}function doeditfields(){var B=getBG();B.g_site_data=new Array();for(var A in data){B.g_site_data[A]=data[A]}B.g_site_data.editfields=1;B.set_editfieldsopener(window);B.openURL(getchromeurl("site.html"),null,B.g_site_data)}function showattach(){}function addattach(){}function rmattach(){}function clearData(){var B=document.getElementsByTagName("input");for(var C=0;C<B.length;C++){if(B[C].type!="button"){B[C].value=""}}var A=document.getElementsByTagName("textarea");for(var C=0;C<A.length;
C++){A[C].value=""}};