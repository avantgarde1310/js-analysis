sr(document,"createanaccount","value","Create an Account");sr(document,"cancel","value","Cancel");var dobeforeunload=true;var docleardata=true;var newdata;function do_submit(){dobeforeunload=false;var A=document.getElementById("reenterpassword").value;var B=getBG().g_create_account_data.masterpassword;if(A!=B){alert(gs("The LastPass master password you reentered does not match"));docleardata=false;document.location.href="create_account.html"}else{document.getElementById("createanaccount").disabled=true;
document.getElementById("cancel").disabled=true;document.getElementById("creatingaccount").style.display="";setInterval("move_password_meter();",10);createAccount()}}var currstrength=0;function move_password_meter(){if(++currstrength>100){currstrength=0}update_password_meter_manual(currstrength)}function createAccount(){if(getBG().LPISLOC){document.getElementById("creatingaccounttext").innerHTML=gs("Reencrypting Data...");var G=fix_username(getBG().g_create_account_data.email);var A=getBG().g_create_account_data.masterpassword;
newdata=getBG().change_master_password(G,A,true);if(typeof(newdata)!="string"||newdata.length<4||newdata.substring(0,4)!="LPAV"){showCreateErrorAndBackup(gs("An error occurred while re-encrypting your data"));return}}document.getElementById("creatingaccounttext").innerHTML=gs("Creating Account...");var F=getBG().g_create_account_data.email.toLowerCase().replace(/\s*/g,"");var I=getBG().g_create_account_data.masterpassword;var C=getBG().SHA256(getBG().SHA256(F+I)+I);var D=getBG().g_create_account_data.improve;
var J=getBG().g_create_account_data.history;var E=getBG().g_create_account_data.timezone;var B=getBG().g_create_account_data.passwordreminder;var H="username="+getBG().en(F)+"&email="+getBG().en(F)+"&hash="+getBG().en(C)+"&password_hint="+getBG().en(B)+(D?"&improve=1":"")+(J?"&loglogins=1":"")+"&timezone2="+getBG().en(E)+"&xml=1&language2=en-US";if(getBG().LPISLOC&&getBG().LPISUPEK){H+="&singlefactortype=vtapi"}getBG().lpMakeRequest(getBG().base_url+"create_account.php",H,lpCreateAccountResponse,lpcreateaccounterror)
}function upload_data(){document.getElementById("creatingaccounttext").innerHTML=gs("Uploading Data...");var B=fix_username(getBG().g_create_account_data.email);var C=getBG().g_create_account_data.masterpassword;var A="wxusername="+encodeURIComponent(B)+"&wxhash="+encodeURIComponent(getBG().SHA256(getBG().SHA256(B+C)+C))+"&data="+encodeURIComponent(btoa(newdata));getBG().lpMakeRequest(getBG().base_url+"import_local.php",A,lpUploadDataResponse,lpuploaddataerror)}function lpCreateAccountResponse(B){if(B.readyState==4&&B.status==200&&B.responseText){var C=B.responseText;
var A="";if(C.indexOf("ok")>=0){if(getBG().LPISLOC){upload_data()}else{getBG().LP_do_login(getBG().g_create_account_data.email,getBG().g_create_account_data.masterpassword,true,false);document.location.href="import_your_data.html"}return}else{if(C.indexOf("usernametaken")>=0){A=gs("Email already in use, have you forgotten your password?")}else{if(C.indexOf("usernameinvalid")>=0||C.indexOf("emailfailed")>=0){A=gs("Invalid email address, try again")}else{A=gs("A server error occurred while processing your request.")
}}}if(A!=""){showCreateErrorAndBackup(A)}}}function showCreateErrorAndBackup(A){alert(A);docleardata=false;document.location.href="create_account.html"}function lpcreateaccounterror(D,B,A,C){showCreateErrorAndBackup(gs("A server error occurred while processing your request."))}function lpUploadDataResponse(A){if(A.readyState==4){if(A.status==200&&A.responseText&&A.responseText.indexOf("ok")>=0){if(getBG().LPISUPEK){if(getBG().have_nplastpass()&&typeof(getBG().g_nplastpass.lpvt_store_data)=="function"){if(getBG().g_nplastpass.lpvt_store_data(encodeURIComponent(fix_username(getBG().g_create_account_data.email))+"|"+encodeURIComponent(getBG().g_create_account_data.masterpassword),gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),gs("Swipe current user's finger"))){getBG().setsinglefactortype("vtapi")
}}}if(getBG().have_nplastpass()&&typeof(getBG().g_nplastpass.delete_file)=="function"){getBG().g_nplastpass.delete_file("LPISLOC")}document.location.href="congratulations.html"}else{lpuploaddataerror()}}}function lpuploaddataerror(D,B,A,C){if(confirm(gs("An error occurred while uploading your data.  Would you like to retry?"))){upload_data()}}document.getElementById("reenterpassword").focus();