function redraw_menu(){var C=getBG().lploggedin;var P=false;for(var D in getBG().g_sites){if(getBG().g_sites[D].fav=="1"&&getBG().check_ident_aid(D)){P=true;break}}var A=[{hidden:C,cmd:"getBG().lplogin()",icon:"images/power_off.png",title:getBG().gs("Login")},{hidden:C,title:'<select style="visibility: hidden;"></select>'},{hidden:!C,cmd:"getBG().lplogoff()",icon:"images/power_off.png",title:getBG().gs("Logoff")},{hidden:!C,cmd:"getBG().openvault()",icon:"images/icon_vault.png",title:getBG().gs("My LastPass Vault")},{hidden:!C,menu:"sites",icon:"images/icon_sites.png",title:getBG().gs("Sites")},{hidden:!C||!P,cmd:"getBG().openfavorites()",icon:"images/icon_favorites.png",title:getBG().gs("Open Favorites")},{hidden:!C,menu:"fillforms",icon:"images/icon_formfill.png",title:getBG().gs("Fill Forms")},{hidden:!C,menu:"tools",icon:"images/icon_tools.png",title:getBG().gs("Tools")},{hidden:!C||getBG().g_premium_exp>lp_get_local_timestamp(),cmd:"getBG().openpremium()",icon:"images/icon_premium.png",title:getBG().gs("Go Premium!")},{hidden:!C,cmd:"getBG().saveall()",icon:"images/icon_saveall.png",title:getBG().gs("Save All Entered Data")},];
var F='<table cellspacing="0" cellpadding="0">';F+="<tr>";var E=true;for(var D=0;D<A.length;D++){if(!A[D].hidden){if(!E&&C){F+='<td style="font-size: 16px;">&nbsp;&nbsp;|&nbsp;&nbsp;</td>'}E=false;var H="";var G="";if(typeof(A[D].cmd)!="undefined"){H='<a href="javascript:'+A[D].cmd+';getBG().close_menu();">';G="</a>"}var M="";if(typeof(A[D].menu)!="undefined"){var J;switch(A[D].menu){case"sites":J=[];var K=getBG().getmatchingsites();for(var B=0;B<K.length;B++){var L=K[B].name;if(K[B].username!=""){L+=" ("+K[B].username+")"
}J.push({cmd:"getBG().fillaid("+K[B].aid+")",title:L})}break;case"fillforms":J=[{cmd:"getBG().addprofile()",title:getBG().gs("Add Profile")},{cmd:"getBG().addcreditcard()",title:getBG().gs("Add Credit Card")},{cmd:"getBG().clearforms()",title:getBG().gs("Clear Forms")},{cmd:"getBG().openchooseprofilecc()",title:getBG().gs("Choose Profile and Credit Card")},];var N=true;for(var B=getBG().g_formfills.length-1;B>=0;B--){if(getBG().check_ident_ffid(getBG().g_formfills[B].ffid)){if(N){J.unshift({title:"----------"});
N=false}J.unshift({cmd:"getBG().fillform("+getBG().g_formfills[B].ffid+")",title:getBG().g_formfills[B].decprofilename})}}break;case"tools":J=[{cmd:"getBG().opengenpw()",title:getBG().gs("Generate Secure Password")},{cmd:"getBG().openprefs()",title:getBG().gs("Preferences")},{cmd:"getBG().openfeedback()",title:getBG().gs("Feedback")},{cmd:"getBG().opensearch()",title:getBG().gs("Site Search")},{cmd:"getBG().recheckpage()",title:getBG().gs("Recheck Page")},{cmd:"getBG().refreshsites()",title:getBG().gs("Refresh Sites")},{cmd:"getBG().openimport()",title:getBG().gs("Import")},{cmd:"getBG().doexport()",title:getBG().gs("Export To LastPass CSV File")},{cmd:"getBG().openprint(false)",title:getBG().gs("Print Sites")},{cmd:"getBG().openprint(true)",title:getBG().gs("Print Secure Notes")},{cmd:"getBG().checkforupdates()",title:getBG().gs("Check For Updates")},{cmd:"getBG().clearCache(false)",title:getBG().gs("Clear Local Cache")},{cmd:"getBG().openseccheck()",title:getBG().gs("Security Check")},{cmd:"getBG().opensessions()",title:getBG().gs("Other Sessions")},{cmd:"getBG().openhelp()",title:getBG().gs("Help...")},{cmd:"getBG().openabout()",title:getBG().gs("About...")},{title:"----------"},{cmd:"getBG().openaddsite()",title:getBG().gs("Add Site")},{cmd:"getBG().openaddsecurenote()",title:getBG().gs("Add Secure Note")},];
break}M=': <select style="width: 75px;" onchange="eval(this.options[this.selectedIndex].value);"><option>'+getBG().gs("Select")+"</option>";for(var B=0;B<J.length;B++){var O="";if(typeof(J[B].cmd)!="undefined"){O+=J[B].cmd+"; getBG().close_menu();"}O+="this.selectedIndex = 0;";M+='<option value="'+O+'">'+J[B].title+"</option>"}M+="</select>"}var I="";if(typeof(A[D].icon)!="undefined"){F+="<td>"+H+'<img border="0" src="'+getchromeurl(A[D].icon)+'">'+G+"</td>";I="&nbsp;"}F+="<td>"+H+I+A[D].title+G+M+"</td>"
}}F+="</tr>";F+="</table>";document.body.innerHTML=F}if(typeof(safari.extension.globalPage)!="undefined"&&safari.extension.globalPage){getBG().drawIconAtRotation(0)};