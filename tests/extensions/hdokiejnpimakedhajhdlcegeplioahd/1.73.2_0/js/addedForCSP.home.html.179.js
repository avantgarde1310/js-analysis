var g_current_version=0;function onLoad(A){if(!A){get_data("vault",function(){onLoad(true)});return}populate();document.getElementById("searchbox").focus();window.addEventListener("keydown",function(B){handle_keydown(B)},false);setTimeout("checkVersion()",500)}function onResize(){document.getElementById("gridsite").style.height=(document.body.clientHeight-document.getElementById("gridsite").offsetTop)+"px"}var g_selectedrow=-1;var g_searchhasfocus=false;function handle_keydown(event){var keycode=event.keyCode!=0?event.keyCode:event.charCode;
if(keycode==40||keycode==38){var i=(keycode==40?g_selectedrow+1:(g_selectedrow==-1?g_ids.length:g_selectedrow-1));if(i+1>g_ids.length||i<0){}else{if(g_selectedrow!=-1){document.getElementById("site"+g_ids[g_selectedrow]).className="site"}g_selectedrow=i;document.getElementById("site"+g_ids[g_selectedrow]).className="site focus"}}else{if(keycode==13&&
/*g_searchhasfocus &&*/
g_selectedrow!=-1){ls(g_ids[g_selectedrow])}}}function clearkeyboardnav(){if(g_selectedrow!=-1){document.getElementById("site"+g_ids[g_selectedrow]).className="site";
g_selectedrow=-1}}var g_ids=[];var g_lastsearch=null;function populate(){var D=getBG();var E=document.getElementById("searchbox").value.toLowerCase();g_lastsearch=E;var A=D.get_searchNotesB64Length();var C=search_results(D,E,A);C.sort(D.lp_sort_case_insensitive_name);s=[];g_ids=[];g_selectedrow=-1;for(var B in C){g_ids.push(C[B].aid);s.push(getsitehtml(C,B))}s.push('<div id="gridclear" class="clear"/>');$("#gridsite").html(s.join(""));s=null;document.getElementById("gridsite").style.height=(document.body.clientHeight-document.getElementById("gridsite").offsetTop)+"px";
g_current_version=D.g_local_accts_version}function checkVersion(A){if(g_issafari||g_isopera){if(!A){getBG().update_state("search");return}}var B=getBG();if(!B.lploggedin||g_current_version!=B.g_local_accts_version){populate()}setTimeout("checkVersion()",500)}function search_results(C,F,A){var B=new Array();for(var D in C.g_sites){if(!C.check_ident_aid(D)){continue}var G=C.g_sites[D];if(G.url=="http://group"){continue}if(G.url.toLowerCase().indexOf(F)!=-1||G.name.toLowerCase().indexOf(F)!=-1||G.group.toLowerCase().indexOf(F)!=-1||G.unencryptedUsername.toLowerCase().indexOf(F)!=-1){B[B.length]=G
}else{if(A>0){var E=C.lpmdec(G.extra.substring(0,A),true);if(E.toLowerCase().indexOf(F)!=-1){B[B.length]=G}}}}for(var D in C.g_securenotes){if(!C.check_ident_aid(D)){continue}var G=C.g_securenotes[D];if(G.name.toLowerCase().indexOf(F)!=-1||G.group.toLowerCase().indexOf(F)!=-1){B[B.length]=G}}return B}function search_go(){populate()}function search_clear(){document.getElementById("searchbox").value="";populate()}function sp(A,C,D){if(A.innerHTML==gs("Show")){var B=getBG();if(B.g_sites[C].sharedfromaid!=null&&B.g_sites[C].sharedfromaid!=""&&B.g_sites[C].sharedfromaid!="0"&&B.g_sites[C].sharedfromaid!="null"){alert(gs("This is a shared site. You are not permitted to view the password."));
return}if(!D&&(B.g_sites[C].pwprotect||B.g_prompts.view_pw_prompt)){B.security_prompt(function(){sp(A,C,true)});return}A.innerText=B.lpmdec(B.g_sites[C].password,true)}else{A.innerHTML=gs("Show")}}function os(B){var A=getBG();A.editAid(B,window);return false}function ds(B){var A=getBG();A.deleteAid(B,window);return false}function ls(B){var A=getBG();A.launch(B);setTimeout(function(){window.close()},0);return false}function search_keyup(C,D){var A=C.charCode?C.charCode:(C.keyCode?C.keyCode:(C.which?C.which:0));
var B=document.getElementById("searchbox").value;if(g_searchhasfocus&&A!=40&&A!=38&&A!=13&&B.length>2){populate()}}var MAX_GROUPNAME_LEN=80;var MAX_SITENAME_LEN=30;var MAX_SITEUSERNAME_LEN=15;function getgrouphtml(E,A,B,C){var D=C?"":'<span>|</span><a href="#" onclick="return eg('+E+')">Edit</a><span>|</span><a onclick="return dg('+E+')" href="#">Delete</a>';return'<div class="group" id="group'+E+'"><div class="border"><div class="groupname" onclick="group_toggle('+E+')" ><span class="sort"><span class="title">'+trunc(A,MAX_GROUPNAME_LEN)+'<span class="count">('+B+')</span></span></span></div><div class="groupaction"><a onclick="return og('+E+')" href="#">Open All</a>'+D+'&nbsp;&nbsp;&nbsp;</div></div></div><div class="groupsites" id="groupsites'+E+'"></div>'
}function getsitehtml(C,A,B){id=C[A].aid;name=trunc(C[A].name,MAX_SITENAME_LEN);username=(typeof(C[A].unencryptedUsername)!="undefined"?trunc(C[A].unencryptedUsername,MAX_SITEUSERNAME_LEN):"");return'<div class="site" id="site'+id+'"><div class="border"><div class="sitename"><span class="content">'+sprite_gethtml(C[A].fiid,C[A].sn)+'<a target="_blank" href="#" onclick="return ls(\''+id+"')\">"+name+'</a></span></div><div class="siteusername"><span class="content">'+username+'</span></div><div class="sitepassword"><span class="content"><a href="#" onclick="return sp(this, \''+id+"')\">"+gs("Show")+'</a></span></div><div class="sitefavorite"><span class="content">'+(C[A].fav=="1"?'<img src="images/icon_favorite.png"/>':"")+'</span></div><div class="sitenote"><span class="content">'+(C[A].extra!=""?'<img src="images/icon_note.png"/>':"")+'</span></div><div class="siteprotected"><span class="content">'+(C[A].pwprotect?'<img src="images/icon_protected.png"/>':"")+'</span></div><div class="siteautologin"><span class="content">'+(C[A].autologin?'<img src="images/icon_autologin.png"/>':"")+'</span></div><div class="siteaction"><a href="#" onclick="return os(\''+id+"')\">"+gs("Edit")+"</a><span>|</span><a onclick=\"return ds('"+id+'\');" href="#">'+gs("Delete")+"</a>&nbsp;&nbsp;&nbsp;</div></div></div>"
}function sprite_gethtml(C,B){var A=getBG();return A.geticonhtml(C,B)}function trunc(B,A){if(B.length<=A){return of(B)}return of(B.substr(0,A))+"..."};